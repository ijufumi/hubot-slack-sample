request = require 'request'
module.exports = (robot) ->
  robot.hear /run\s+(\w+)/i, (msg) ->
    user = msg.message.user.name.toLowerCase()
    if (user != 'iju')
      msg.reply "You are not allowd executing command [" + user + "]"

    jobs = msg.match[1]
    request.post
      url : "http://JENKINS_SERVER/jenkins/view/dev_pipeline/job/" + jobs + "/build"
      headers : {'Authorization' : 'Basic ' + new Buffer('iju:password').toString('base64')}
      , (err, res, body) ->
        message = "execute " + jobs + " is succeed."
        if (err || body)
           message = "execute " + jobs + " is faild."
        msg.reply message

