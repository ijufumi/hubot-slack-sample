module.exports = (robot) ->
  robot.respond /dev\s*((reboot|build)/i, (msg) ->
    user = msg.message.user.name.toLowerCase()
    room = msg.envelope.room
    if (room != 'develop')
      msg.reply "NG! This room is not allowed execute command #" + room
      return

    if (user in ['iju'])
      msg.reply "OK!  You can execute deploy " + msg.match[1] + " @" + user
    else
      msg.reply "NG! You are not allowed execute deploy @" + user
      return

    @exec = require('child_process').exec
    command = '/home/iju/work/dev.sh ' + msg.match[1]
    @exec command, (error, stdout, stderr) ->
      msg.reply error if error?
      msg.reply "dev finished."
